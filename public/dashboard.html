<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Quản Lý Hệ Thống IoT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <style>
        /* CSS Tùy Chỉnh Nâng Cấp */
        body {
            /* Màu nền nhẹ nhàng, chuyên nghiệp */
            background-color: #f5f7fa;
        }

        .navbar {
            /* Shadow sâu hơn, viền dưới tạo điểm nhấn */
            box-shadow: 0 4px 10px rgba(0, 0, 0, .15);
            border-bottom: 3px solid #1abc9c;
        }

        .card {
            /* Bo tròn lớn hơn cho cảm giác hiện đại */
            border-radius: 0.8rem;
            border: none;
        }

        .card-sensor {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
            border-left: 6px solid;
            /* Viền dày hơn */
        }

        .card-sensor:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.15);
            /* Shadow nổi bật */
        }

        /* Màu cho từng loại sensor (Sử dụng màu sắc Bootstrap tối hơn cho độ tương phản) */
        .temp {
            border-left-color: #dc3545;
        }

        /* Đỏ Danger */
        .humi {
            border-left-color: #0d6efd;
        }

        /* Xanh Dương Primary */
        .pres {
            border-left-color: #ffc107;
        }

        /* Vàng Warning */
        .alti {
            border-left-color: #198754;
        }

        /* Xanh Lá Success */

        .value-large {
            font-size: 3rem;
            font-weight: 800;
            /* In đậm hơn */
            color: #343a40;
            /* Màu chữ tối */
        }

        /* Style cho Control Panel mới */
        .control-panel {
            background-color: #ffffff;
            border-radius: 0.8rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
            margin-bottom: 2rem;
        }

        /* Style cho khu vực lọc chart */
        .filter-section {
            background-color: #ffffff;
            border-radius: 0.8rem;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
        }

        /* Đảm bảo bảng hiển thị đẹp trên mọi thiết bị */
        .table-responsive {
            max-height: 400px;
            /* Giới hạn chiều cao cho bảng cuộn */
            overflow-y: auto;
        }
        #clock {
        font-size: 2rem;
        letter-spacing: 2px;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-satellite-dish me-2"></i>
                IoT Monitor Dashboard
            </a>
            <div class="d-flex align-items-center">
                <span class="navbar-text text-light me-3 d-none d-lg-inline">
                    <i class="fas fa-user-circle me-1"></i> <strong id="user-account">@Accounts</strong>
                </span>
                <button id="logout-btn" class="btn btn-danger btn-sm shadow-sm">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <h2 class="mb-1 text-center text-primary">Dữ Liệu Cảm Biến</h2>
        <h3 id="clock" class="mb-5 text-center text-secondary">--:--:--</h3>

        <div class="row mb-4">
            <div class="col-12">
                <div class="control-panel">
                    <h5 class="text-secondary mb-3"><i class="fas fa-cogs me-2"></i>Điều Khiển Thiết Bị</h5>

                    <div class="mb-3">
                        <select id="deviceSelect" class="form-select">
                            <option value="">Đang tải danh sách thiết bị...</option>
                        </select>
                    </div>

                    <div class="d-flex flex-wrap gap-3">
                        <button id="btn-sync" class="btn btn-lg btn-primary shadow-sm">
                            <i class="fas fa-sync-alt me-2"></i> Cập nhật Thông số
                        </button>
                        <button id="btn-toggle" class="btn btn-lg btn-danger shadow-sm">
                            <i class="fas fa-toggle-off me-2"></i> Đang tải trạng thái
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-lg card-sensor temp h-100">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto me-3">
                                <i class="fas fa-thermometer-three-quarters fa-4x text-danger"></i>
                            </div>
                            <div class="col">
                                <div class="text-uppercase text-danger fw-bold mb-1 fs-5">Nhiệt Độ</div>
                                <div class="value-large mb-0" id="current-temp">-- °C</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-lg card-sensor humi h-100">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto me-3">
                                <i class="fas fa-tint fa-4x text-primary"></i>
                            </div>
                            <div class="col">
                                <div class="text-uppercase text-primary fw-bold mb-1 fs-5">Độ Ẩm</div>
                                <div class="value-large mb-0" id="current-humi">-- %</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-lg card-sensor pres h-100">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto me-3">
                                <i class="fas fa-cloud fa-4x text-warning"></i>
                            </div>
                            <div class="col">
                                <div class="text-uppercase text-warning fw-bold mb-1 fs-5">Áp Suất</div>
                                <div class="value-large mb-0" id="current-pres">-- hPa</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card shadow-lg card-sensor alti h-100">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto me-3">
                                <i class="fas fa-mountain fa-4x text-success"></i>
                            </div>
                            <div class="col">
                                <div class="text-uppercase text-success fw-bold mb-1 fs-5">Độ Cao</div>
                                <div class="value-large mb-0" id="current-alti">-- m</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="row mt-4">

            <div class="col-lg-12 mb-4">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-white d-flex justify-content-between align-items-center">
                        <h6 class="m-0 fw-bold text-primary"><i class="fas fa-chart-area me-2"></i>Biểu Đồ Lịch Sử</h6>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                                data-bs-toggle="dropdown" aria-expanded="false" id="chart-selector-btn">
                                Chọn Cảm Biến
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-sensor="temperature">Nhiệt Độ</a></li>
                                <li><a class="dropdown-item" href="#" data-sensor="humidity">Độ Ẩm</a></li>
                                <li><a class="dropdown-item" href="#" data-sensor="pressure">Áp Suất</a></li>
                                <li><a class="dropdown-item" href="#" data-sensor="altitude">Độ Cao</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="historicalChart"></canvas>
                    </div>
                </div>
            </div>



        </div>
        <!-- NEW: Filter Section - Bộ Lọc Tra Cứu Dữ Liệu -->
        <div class="row mt-2">
            <div class="col-lg-12 mb-4">
                <div class="filter-section">
                    <h5 class="text-secondary mb-3"><i class="fas fa-filter me-2"></i>Tra Cứu Dữ Liệu</h5>
                    <form id="data-filter-form" class="row g-3 align-items-end">

                        <!-- Bộ lọc Ngày -->
                        <div class="col-md-3">
                            <label for="filterDate" class="form-label fw-bold">Chọn Ngày:</label>
                            <input type="date" class="form-control" id="filterDate" value="2025-11-11">
                        </div>

                        <!-- Bộ lọc Thời gian Bắt đầu -->
                        <div class="col-md-2">
                            <label for="filterTimeStart" class="form-label fw-bold">Giờ Bắt đầu:</label>
                            <input type="time" class="form-control" id="filterTimeStart" value="08:00">
                        </div>

                        <!-- Bộ lọc Thời gian Kết thúc -->
                        <div class="col-md-2">
                            <label for="filterTimeEnd" class="form-label fw-bold">Giờ Kết thúc:</label>
                            <input type="time" class="form-control" id="filterTimeEnd" value="12:00">
                        </div>

                        <!-- Bộ lọc Loại Cảm Biến -->
                        <div class="col-md-3">
                            <label for="filterSensorType" class="form-label fw-bold">Chọn Loại Cảm Biến:</label>
                            <select class="form-select" id="filterSensorType">
                                <option value="all">Tất Cả</option>
                                <option value="temperature">Nhiệt Độ (°C)</option>
                                <option value="humidity">Độ Ẩm (%)</option>
                                <option value="pressure">Áp Suất (hPa)</option>
                                <option value="altitude">Độ Cao (m)</option>
                            </select>
                        </div>

                        <!-- Nút Tra Cứu -->
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search me-2"></i>Tra
                                Cứu</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results Table - Bảng Kết Quả Tra Cứu -->
        <div class="row mt-0">
            <div class="col-lg-12">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-white">
                        <h6 class="m-0 fw-bold text-success"><i class="fas fa-table me-2"></i>Bảng Kết Quả Tra Cứu
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 30%;">Thời Gian</th>
                                        <th style="width: 30%;">Loại Cảm Biến</th>
                                        <th style="width: 25%;">Giá Trị</th>
                                        <th style="width: 15%;">Đơn Vị</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted p-4">Vui lòng chọn bộ lọc và
                                            nhấn "Tra Cứu" để xem dữ liệu lịch sử.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="bg-light p-3 mt-5 border-top">
        <div class="container-fluid text-center text-muted">
            <p class="mb-0">© 2025 Hệ Thống Quản Lý IoT. Sử dụng Bootstrap 5 và Chart.js.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>

</body>

</html>